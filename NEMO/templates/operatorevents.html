{% extends 'base.html' %}
{% block title %}Operator event reports{% endblock %}
{% block extrahead %}
	{% load static %}
	<script type="text/javascript" src="{% static "datetimepicker/bootstrap-datetimepicker.js" %}"></script>
	<link rel="stylesheet" type="text/css" href="{% static "datetimepicker/bootstrap-datetimepicker.css" %}" />
{% endblock %}
{% block content %}
	<h1>Operator event reports</h1>
	<form id="view_records" action="{% url 'operatorevents' %}" class="form-inline" method="get">
	<input type="hidden" id="outputtype" name="outputtype" value="table">
	<p>
	Compile
	<select name="eventtype" id="eventtype">
		<option value="reservation" {% if eventtype == 'reservation' %}selected{% endif %}>reservation</option>
		<option value="usage" {% if eventtype == 'usage' %}selected{% endif %}>usage</option>
	</select>
	report for
	<select name="operatorid" id="operatorid">{% for o in operators %}
		<option value="{{ o.id }}"
		{% if o.id == operatorid %}selected{% endif %}>
		{{ o.last_name }} {{ o.first_name }} ({{ o.affiliation }})</option>
	{% endfor %}</select>
	<br />
		<div class="form-group">
			<div class="datetimepicker-container">
				between <input type="text" id="start" name="start" class="form-control" autocomplete="off" value="{{ start|date:'Y-m-d' }}">
			</div>
		</div>
		<div class="form-group">
			<div class="datetimepicker-container">
				and <input type="text" id="end" name="end" class="form-control" autocomplete="off" value="{{ end|date:'Y-m-d' }}">
			</div>
		</div>
	<br />
		<div class="form-group">
			<input type="submit" class="btn btn-default" value="View event records" onclick="javascript: form.action=' {% url 'operatorevents' %}';">
		</div>
	</form>
	<div class="col-lg-12" style="margin-top:30px">
		{% if events %}
			<h3>{{ eventtype }} events for {{ operatorname }}</h3>
			<h5>{{ start }} &mdash; {{ end }}</h5>
			<p><small><em>get this data as
			<a href="{% url 'operatorevents' %}?outputtype=txt&eventtype={{ eventtype }}&operatorid={{ operatorid }}&start={{ start|date:'Y-m-d' }}&end={{ end|date:'Y-m-d' }}">TAB-separated text</a>
			or <a href="{% url 'operatorevents' %}?outputtype=xlsx&eventtype={{ eventtype }}&operatorid={{ operatorid }}&start={{ start|date:'Y-m-d' }}&end={{ end|date:'Y-m-d' }}">XLSX-formatted spreadsheet</a>
			</em></small></p>
			<table class="table table-bordered table-condensed">
				<thead>
					<tr>
						<th>Start</th>
						<th>End</th>
						<th>Duration/h</th>
						<th>Tool</th>
						<th>Project</th>
						<th>User</th>
						<th>Affiliation</th>
				{% if eventtype == "reservation" %}
						<th>Title</th>
				{% endif %}
					</tr>
				</thead>
				<tbody>
					{% for e in events %}
						<tr>
							<td>{{ e.start }}</td>
							<td>{{ e.end }}</td>
							<td>{{ e.hours|floatformat:2 }}</td>
							<td>{{ e.toolname }}</td>
							<td>{{ e.projectname }}</td>
							<td>{{ e.user }}</td>
							<td>{{ e.affiliation }}</td>
				{% if eventtype == "reservation" %}
							<td>{{ e.remarks }}</td>
				{% endif %}
						</tr>
					{% endfor %}
				</tbody>
			</table>
		{% else %}
			{% if operatorid == 0 %}<p>{# Sorry, you don't have permission for viewing "{{ operatorname }}"! #}</p>
			{% elif start or end %}
				No records exist between {{ start }} and {{ end }} for "{{ operatorname }}" {{ eventtype }} events.
				(Or you may not be allowed to see them.)
			{% endif %}
		{% endif %}
	</div>
	<script>
		function on_load()
		{
			var timepicker_properties =
			{
				format: 'YYYY-MM-DD'
			};
			$('#start').datetimepicker(timepicker_properties);
			$('#end').datetimepicker(timepicker_properties);
		}
		$(on_load);
	</script>
{% endblock %}
